<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Watermark Test</title>
</head>
<body>
    <script>
        const apiURL = 'https://quickchart.io/watermark';
const markedIMG = 'https://static.vecteezy.com/system/resources/thumbnails/017/785/303/small/creative-wrong-icon-3d-render-png.png';

class Product {
    constructor(rawImageLink = '', div = null) {
        this.div = div; // Optionally attach a container div
        this.imageHTMLElement = null; // Store the rendered image element
        this.rawImageLink = rawImageLink; // URL of the base image
        this.processedImage = null; // URL of the generated image
    }

    async processImage() {
        // Ensure rawImageLink is provided
        if (!this.rawImageLink) {
            console.error('Error: rawImageLink is required to process the image.');
            return;
        }

        // Prepare the request payload
        const params = {
            mainImageUrl: this.rawImageLink,
            markImageUrl: markedIMG,
            position: 'center',
            opacity: 0.8,
            markRatio: 1.0,
        };

        try {
            // Send the POST request to the API
            const response = await fetch(apiURL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(params),
            });

            // Validate the response
            if (!response.ok) {
                const errorMessage = await response.text();
                throw new Error(`HTTP error! Status: ${response.status}. Message: ${errorMessage}`);
            }

            // Convert response to Blob (image)
            const data = await response.blob();

            // Generate and store the processed image URL
            const imageUrl = URL.createObjectURL(data);
            this.processedImage = imageUrl;
            console.log('Processed image URL:', this.processedImage);

            // Render the image on the page
            this.renderImage(imageUrl);
        } catch (error) {
            console.error('Error creating overlay:', error);
        }
    }

    renderImage(imageUrl) {
        // Create or update the image element
        if (!this.imageHTMLElement) {
            this.imageHTMLElement = document.createElement('img');
            this.imageHTMLElement.alt = 'Processed Image';
            if (this.div) {
                this.div.appendChild(this.imageHTMLElement); // Attach to container if provided
            } else {
                document.body.appendChild(this.imageHTMLElement); // Default to body
            }
        }

        this.imageHTMLElement.src = imageUrl; // Set the image source
    }
}

// Example usage:
const product1 = new Product(
    'https://i5.walmartimages.com/asr/6c5b099e-175c-42f2-aa2d-5d1045698879.73425eb6afa1522dd2fd08c53ab26698.jpeg?odnHeight=612&odnWidth=612&odnBg=FFFFFF'
);

product1.processImage();

    </script>
</body>
</html>